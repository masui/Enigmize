<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="icon" type="image/png" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/enigmize.css" />
    <!--
    <script type="text/javascript" src="/javascripts/jquery.js"></script>
    <script type="text/javascript" src="/javascripts/jsencrypt.min.js"></script>
    -->
    <title>Enigmize</title>
  </head>
  
  <body>
    
    <h1><%= @name %>@<%= @domain %> のインク情報</h1>
    
    <ul>
      <li>以下の<a href="<%= @email %>.ink"><%= @email %> のインク</a>を塗ると情報は読めなくなります</li>
      <pre id="publickey">
      </pre>
      <!-- <= @ink %> -->
      <li><%= @email %> の<b>秘密のインク消し</b>を使うと読めるようになります</li>
      <li>このページにデータをDrag&amp;Dropするとインクを塗ったデータに変換することができます</li>
    </ul>

    <p />
    
    <a href="/">トップに戻る</a>
    <p />
    <a id="download">秘密のインク消し (秘密鍵)</a>

    <!--
    <script type="text/javascript">
      var crypt;
      
      function datestr(){
        var dt = new Date();
        return dt.getFullYear() +
          ("00" + (dt.getMonth()+1)).slice(-2) +
          ("00" + dt.getDate()).slice(-2) +
          ("00" + (dt.getHours())).slice(-2) +
          ("00" + (dt.getMinutes())).slice(-2) +
          ("00" + (dt.getSeconds())).slice(-2);
      }

      function getfile(file){
        fileReader = new FileReader();
        fileReader.onload = function(event){
          data = event.target.result //  読んだファイルの内容
          console.log(data)  
          var enc = crypt.encrypt(data)
          alert(enc)
          var blob = new Blob([ enc ], { type: "application/octet-stream" });
          var url = URL.createObjectURL(blob);
          const a = $('<a>')
          a.attr('href',url)
          a.attr('download','output.bin');
          a.css('display','none')
          $('body').append(a)
          a.click();
          $('body').remove(a)
        }
        //fileReader.readAsBinaryString(file)
        fileReader.readAsText(file)
      }

      
      $('body').bind("dragover", function(e){
        return false;
      }).bind("dragend", function(e){
        return false;
      }).bind("drop", function(e){
        e.preventDefault();  //  デフォルトは「ファイルを開く」
        files = e.originalEvent.dataTransfer.files;
        getfile(files[0]);
      })
      
      $(function () {
	var a = $('#download');
	a.attr('download','SECRET_INK_REMOVER_' + datestr());
      
        crypt = new JSEncrypt({default_key_size: 2048});

      var secretKey = crypt.getPrivateKey() + "\n"
      var blob = new Blob([ secretKey ], { type: "text/plain" });
      var url = URL.createObjectURL(blob);
      a.attr('href',url)

      //a.attr('href','data:text/plain,' + encodeURIComponent(secretKey));
      //a.attr('download','SECRET_INK_REMOVER_' + datestr());
      //a.click();

      $('#publickey').text(crypt.getPublicKey())

      $.ajax({
        type: "POST",
        async: true,
        url: "/__save_public_key",
        data: "key=" + crypt.getPublicKey()
      });

      
      //alert(crypt.encrypt("abcde"));
//alert(ink);
//crypt.setKey(ink);
//alert(crypt.getPublicKey());
//alert(crypt.encrypt("abcde"));
})
    </script>
-->

    <script type="text/javascript" src="/javascripts/bundle.js"></script>
    
  </body>
</html>

